p8105_hw6_ym3139
================
Yutong Mao (UNI: ym3139)
2025-12-03

# Problem 0

In this problem, I created a public GitHub repository and associated R
Project for Homework 6. Within the project directory, I created a single
R Markdown file named `p8105_hw6_ym3139.Rmd` that renders to
`github_document`, and a `data/` subdirectory that stores all local data
files.

All my solutions for Problems 1 and 2 are contained in this R Markdown
file. I used git for version control, and my commit history reflects the
process of developing these solutions.

# Problem 1

``` r
# Read raw homicide data
homicide_df_raw = 
  read_csv("data/homicide-data.csv")

# Clean data and create variables
homicide_df = 
  homicide_df_raw |> 
  mutate(
    # City + state label
    city_state = str_c(city, ", ", state),
    # Binary outcome: 1 = closed by arrest, 0 = otherwise
    resolved = as.numeric(disposition == "Closed by arrest"),
    # Convert age to numeric; "Unknown" will become NA
    victim_age = as.numeric(victim_age),
    # Set reference levels for race and sex
    victim_race = fct_relevel(victim_race, "White"),
    victim_sex  = fct_relevel(victim_sex, "Female")
  ) |> 
  # Drop cities with missing race information and the Tulsa, AL error
  filter(
    !city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO"),
    !(city == "Tulsa" & state == "AL")
  ) |> 
  # Keep only Black and White victims
  filter(victim_race %in% c("White", "Black")) |> 
  # Remove observations with missing key variables
  drop_na(victim_age, victim_race, victim_sex)

# Quick check of number of observations per city
homicide_df |> 
  count(city_state)
```

    ## # A tibble: 47 × 2
    ##    city_state          n
    ##    <chr>           <int>
    ##  1 Albuquerque, NM   174
    ##  2 Atlanta, GA       940
    ##  3 Baltimore, MD    2753
    ##  4 Baton Rouge, LA   409
    ##  5 Birmingham, AL    763
    ##  6 Boston, MA        492
    ##  7 Buffalo, NY       472
    ##  8 Charlotte, NC     571
    ##  9 Chicago, IL      4502
    ## 10 Cincinnati, OH    678
    ## # ℹ 37 more rows

``` r
# Subset data to Baltimore, MD
baltimore_df = 
  homicide_df |> 
  filter(city_state == "Baltimore, MD")

# Fit logistic regression model
baltimore_glm = 
  baltimore_df |> 
  glm(
    resolved ~ victim_age + victim_sex + victim_race,
    data = _,
    family = binomial()
  )

# Extract odds ratio and 95% CI for male vs female victims
baltimore_or = 
  baltimore_glm |> 
  broom::tidy(conf.int = TRUE, exponentiate = TRUE) |> 
  filter(term == "victim_sexMale") |> 
  select(term, estimate, conf.low, conf.high)

baltimore_or
```

    ## # A tibble: 1 × 4
    ##   term           estimate conf.low conf.high
    ##   <chr>             <dbl>    <dbl>     <dbl>
    ## 1 victim_sexMale    0.426    0.324     0.558

``` r
library(purrr)

# Fit city-specific logistic models and extract ORs and CIs
city_or_results = 
  homicide_df |> 
  group_by(city_state) |> 
  nest() |> 
  mutate(
    # Fit logistic regression within each city
    glm_fit = map(
      data,
      \(df) glm(
        resolved ~ victim_age + victim_sex + victim_race,
        data = df,
        family = binomial()
      )
    ),
    # Tidy regression output and compute ORs and CIs
    tidy_fit = map(
      glm_fit,
      \(mod) broom::tidy(mod, conf.int = TRUE, exponentiate = TRUE)
    )
  ) |> 
  select(city_state, tidy_fit) |> 
  unnest(tidy_fit) |> 
  # Keep the coefficient comparing male vs female victims
  filter(term == "victim_sexMale") |> 
  select(
    city_state,
    or_est = estimate,
    or_low = conf.low,
    or_high = conf.high
  )

# Preview results
city_or_results |> head()
```

    ## # A tibble: 6 × 4
    ## # Groups:   city_state [6]
    ##   city_state      or_est or_low or_high
    ##   <chr>            <dbl>  <dbl>   <dbl>
    ## 1 Albuquerque, NM  1.77   0.825   3.76 
    ## 2 Atlanta, GA      1.00   0.680   1.46 
    ## 3 Baltimore, MD    0.426  0.324   0.558
    ## 4 Baton Rouge, LA  0.381  0.204   0.684
    ## 5 Birmingham, AL   0.870  0.571   1.31 
    ## 6 Boston, MA       0.674  0.353   1.28

``` r
# Order cities by estimated odds ratio
city_or_results_plot = 
  city_or_results |> 
  mutate(
    city_state = fct_reorder(city_state, or_est)
  )

# Plot ORs and 95% CIs by city
ggplot(city_or_results_plot, aes(x = city_state, y = or_est)) + 
  geom_point() +
  geom_errorbar(aes(ymin = or_low, ymax = or_high), width = 0) +
  geom_hline(yintercept = 1, linetype = "dashed") +
  coord_flip() +
  labs(
    x = "City",
    y = "Adjusted OR (Male vs Female)",
    title = "Adjusted odds ratios for case resolution\ncomparing male to female victims by city"
  ) +
  theme_minimal()
```

![](p8105_hw6_ym3139_files/figure-gfm/problem1-or-plot-1.png)<!-- -->

Overall, most cities show adjusted odds ratios below 1, indicating that
homicides involving male victims are less likely to be solved than those
involving female victims after adjusting for age and race. Several
cities display confidence intervals entirely below 1, suggesting a
statistically significant disadvantage for male victims. A few cities
have point estimates above 1, but all of their confidence intervals
include 1, so there is no strong evidence that male-victim cases are
more likely to be solved in those locations. The results highlight
substantial variability across cities but suggest a general pattern of
lower clearance rates for male victims.
